<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Spin Result - Lucky Slot</title>
    <link rel="stylesheet" href="./src/crt.css" />
    <style>
      :root { --blue:#0b64d8; --panel:#ffffff; --text:#0f1426; }
      html, body { height: 100%; margin: 0; overflow: hidden; font-family: Segoe UI, system-ui, -apple-system, Roboto, sans-serif; }
      body { background: radial-gradient(circle at 50% -20%, #002fcb 0%, #70b3ff 60%, #004e83 100%); }
      .win-overlay {
        position: fixed;
        inset: 0;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: clamp(8px, 1vw, 16px);
        align-content: center;
        justify-items: center;
        padding: 4vh 4vw;
        font-size: clamp(18px, 3.8vw, 38px);
        font-weight: 800;
        letter-spacing: 0.06em;
        color: rgba(255,255,255,0.5);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.4s ease;
        z-index: 0;
        text-transform: uppercase;
      }
      .win-overlay.is-active {
        opacity: 1;
      }
      .win-overlay span {
        white-space: nowrap;
      }
      .wrap {
        min-height: 100dvh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 4vh 2vw;
        box-sizing: border-box;
        position: relative;
        z-index: 1;
      }
      .card { width: clamp(0px, 60vw, 720px); max-width: 720px; margin-left: auto; margin-right: auto; background: var(--panel); color: var(--text); border-radius: 16px; box-shadow: 0 24px 60px rgba(0,0,0,.25); padding: clamp(18px, 4vw, 32px); text-align: center; }
      .title { margin: 0 0 4px; font-size: clamp(26px, 5.5vw, 36px); font-weight: 800; }
      .eyebrow { margin: 6px 0 4px; text-transform: uppercase; letter-spacing: 0.24em; font-size: 0.85rem; color: #66739e; }
      .result-code { font-size: clamp(42px, 12vw, 72px); font-weight: 900; letter-spacing: 0.2em; margin: 8px 0 6px; }
      .full-term { margin: 0 0 8px; font-size: clamp(18px, 4.2vw, 24px); font-weight: 600; color: #1b2554; }
      .message { margin: 0 0 16px; font-size: 1.05rem; color: #334275; }
      .countdown { margin: 18px 0 0; color: #5a6693; font-size: 0.95rem; letter-spacing: 0.08em; }
    </style>
  </head>
  <body class="crt crt-bulge crt-effect">
    <div class="win-overlay" id="winOverlay" aria-hidden="true"></div>
    <div class="wrap">
      <div class="card">
        <h1 class="title">Spin Result</h1>
        <!-- <p class="eyebrow">Status</p> -->
        <div id="result-code" class="result-code">---</div>
        <p class="full-term" id="full-term">Awaiting spin</p>
        <p class="message" id="message">Spin to see a result.</p>
        <p class="countdown" id="countdown">Tap anywhere to return home. 120s…</p>
      </div>
    </div>
    <script>
      (function(){
        const elCode = document.getElementById('result-code');
        const elFull = document.getElementById('full-term');
        const elMessage = document.getElementById('message');
        const elCountdown = document.getElementById('countdown');
        const overlay = document.getElementById('winOverlay');

        function activateOverlay(text){
          if (!overlay) return;
          const items = Array.from({ length: 60 }, () => `<span>${text}</span>`);
          overlay.innerHTML = items.join('');
          overlay.classList.add('is-active');
        }
        try { localStorage.removeItem('spinLocked'); } catch (_) {}

        try {
          const raw = localStorage.getItem('lastSpin');
          if (!raw) throw new Error('no data');
          const data = JSON.parse(raw);
          elCode.textContent = data.code || '---';
          elFull.textContent = data.full || 'Unavailable';
          elMessage.textContent = data.message || 'Please spin again.';

          const rawChance = parseFloat(localStorage.getItem('spinWinChance') || '0');
          const chanceText = Number.isFinite(rawChance) ? `${(rawChance * 100).toFixed(1)}%` : '0%';
          if ((data.code || '').toUpperCase() !== 'H1B') {
            activateOverlay(chanceText);
          } else if (overlay) {
            overlay.innerHTML = '';
            overlay.classList.remove('is-active');
          }
        } catch (e) {
          elCode.textContent = '---';
          elFull.textContent = 'No result';
          elMessage.textContent = 'Spin to see a result.';
          if (overlay) {
            overlay.innerHTML = '';
            overlay.classList.remove('is-active');
          }
        }

        let seconds = 120;
        const updateCountdown = () => {
          if (!elCountdown) return;
          elCountdown.textContent = `Tap anywhere to return home, ${seconds}s…`;
        };
        updateCountdown();
        const timer = setInterval(() => {
          seconds -= 1;
          updateCountdown();
          if (seconds <= 0) {
            clearInterval(timer);
            window.location.href = './screensaver.html';
          }
        }, 1000);

        function goHome() {
          window.location.href = './screensaver.html';
        }
        document.body.addEventListener('click', goHome);
        const card = document.querySelector('.card');
        if (card) {
          card.addEventListener('click', (e) => {
            e.stopPropagation();
            goHome();
          });
        }
      })();
    </script>
  </body>
  </html>
